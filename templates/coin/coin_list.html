{% extends 'base.html' %}
{% load bootstrap5 %}
{% block title %}Список монет{% endblock %}

{% block sidebar %}
    <!-- Перемещаем форму фильтрации наверх -->
    <div class="col-md-12 mb-4">
        <div class="card">
            <div class="card-body">
                <form method="get">
                    {% csrf_token %}
                    <h5 class="card-title">Фильтры</h5>
                    {{ filter.form.as_p }}  <!-- Отображаем форму фильтра -->
                    <button type="submit" class="btn btn-primary">Поиск</button>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block content %}
    <!-- Таблица монет -->
    <table class="table table-bordered">
        <thead>
        <tr>
            <th>
                <a href="?sort=name{% if request.GET.sort == 'name' and request.GET.order != 'desc' %}&order=desc{% endif %}">
                    Название
                    {% if request.GET.sort == 'name' %}
                        {% if request.GET.order == 'desc' %}▼{% else %}▲{% endif %}
                    {% endif %}
                </a>
            </th>
            <th>
                <a href="?sort=country{% if request.GET.sort == 'country' and request.GET.order != 'desc' %}&order=desc{% endif %}">
                    Страна
                    {% if request.GET.sort == 'country' %}
                        {% if request.GET.order == 'desc' %}▼{% else %}▲{% endif %}
                    {% endif %}
                </a>
            </th>
            <th>
                <a href="?sort=year{% if request.GET.sort == 'year' and request.GET.order != 'desc' %}&order=desc{% endif %}">
                    Год выпуска
                    {% if request.GET.sort == 'year' %}
                        {% if request.GET.order == 'desc' %}▼{% else %}▲{% endif %}
                    {% endif %}
                </a>
            </th>
            <th>
                <a href="?sort=price{% if request.GET.sort == 'price' and request.GET.order != 'desc' %}&order=desc{% endif %}">
                    Цена
                    {% if request.GET.sort == 'price' %}
                        {% if request.GET.order == 'desc' %}▼{% else %}▲{% endif %}
                    {% endif %}
                </a>
            </th>
            <th>Материалы</th>
            <th>Изображение</th>
        </tr>
        </thead>
        <tbody>
        {% for coin in coins %}
            <tr>
                <td><a href="{% url 'coin_detail' coin.id %}">{{ coin.name }}</a></td>
                <td>{{ coin.country.name }}</td>
                <td>{{ coin.year }}</td>
                <td>{{ coin.price }}</td>
                <td>
                    {% for material in coin.material.all %}
                        {{ material.name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </td>
                <td>
                    {% if coin.image %}
                        <img src="{{ coin.image.url }}" alt="{{ coin.name }}" width="50">
                    {% else %}
                        <span class="text-muted">Нет изображения</span>
                    {% endif %}
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="6" class="text-center">Монеты не найдены</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <!-- Пагинация -->
    <div class="mt-4">
        {% if coins.has_previous %}
            <a href="?page=1{% if request.GET %}&{{ request.GET.urlencode }}{% endif %}" class="btn btn-secondary">Первая</a>
            <a href="?page={{ coins.previous_page_number }}{% if request.GET %}&{{ request.GET.urlencode }}{% endif %}" class="btn btn-secondary">Предыдущая</a>
        {% endif %}
        <span>Страница {{ coins.number }} из {{ coins.paginator.num_pages }}</span>
        {% if coins.has_next %}
            <a href="?page={{ coins.next_page_number }}{% if request.GET %}&{{ request.GET.urlencode }}{% endif %}" class="btn btn-secondary">Следующая</a>
            <a href="?page={{ coins.paginator.num_pages }}{% if request.GET %}&{{ request.GET.urlencode }}{% endif %}" class="btn btn-secondary">Последняя</a>
        {% endif %}
    </div>
{% endblock %}
